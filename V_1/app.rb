require 'bundler'

Bundler.require(:default)
app_files = Dir['lib/**/*.rb']
app_files.each { |f| require_relative f }
customer_parser = CustomerParserService.new(File.join(Dir.pwd, 'data/rc101.csv'))
@customers = customer_parser.parse
@count = @customers.count
INFINITY = Float::INFINITY
Distance_matrix = GenerateDistanceMatrixService.new(@customers, @count).distance_matrix
Size_start_matrix = Distance_matrix.count
test_matrix = { 0=>{0=>Infinity, 1=>15.231546211727817, 2=>18.0, 3=>22.360679774997898, 4=>25.0, 5=>20.615528128088304, 6=>11.180339887498949, 7=>21.213203435596427, 8=>26.248809496813376, 9=>32.01562118716424, 10=>25.495097567963924, 11=>33.54101966249684, 12=>15.0, 13=>11.180339887498949, 14=>32.01562118716424, 15=>30.4138126514911, 16=>29.154759474226502, 17=>30.4138126514911, 18=>15.811388300841896},
                1=>{0=>15.231546211727817, 1=>Infinity, 2=>32.55764119219941, 3=>14.560219778561036, 4=>32.202484376209235, 5=>32.202484376209235, 6=>24.839484696748443, 7=>21.02379604162864, 8=>31.575306807693888, 9=>17.804493814764857, 10=>15.556349186104045, 11=>26.40075756488817, 12=>16.64331697709324, 13=>26.40075756488817, 14=>46.87216658103186, 15=>45.35416188179427, 16=>42.44997055358225, 17=>40.70626487409524, 18=>22.847319317591726}, 
                2=>{0=>18.0, 1=>32.55764119219941, 2=>Infinity, 3=>34.40930106817051, 4=>20.223748416156685, 5=>23.853720883753127, 6=>16.401219466856727, 7=>36.24913792078372, 8=>36.069377593742864, 9=>47.4236228055175, 10=>43.289721643826724, 11=>50.28916384272063, 12=>23.430749027719962, 13=>9.433981132056603, 14=>21.18962010041709, 15=>13.0, 16=>25.179356624028344, 17=>32.69556544854363, 18=>27.459060435491963}, 
                3=>{0=>22.360679774997898, 1=>14.560219778561036, 2=>34.40930106817051, 3=>Infinity, 4=>25.0, 5=>42.720018726587654, 6=>33.54101966249684, 7=>35.35533905932738, 8=>45.044422518220834, 9=>15.0, 10=>29.154759474226502, 11=>40.311288741492746, 12=>11.180339887498949, 13=>32.01562118716424, 14=>53.150729063673246, 15=>47.16990566028302, 16=>51.478150704935004, 17=>52.20153254455275, 18=>35.35533905932738}, 
                4=>{0=>25.0, 1=>32.202484376209235, 2=>20.223748416156685, 3=>25.0, 4=>Infinity, 5=>41.23105625617661, 6=>31.622776601683793, 7=>46.09772228646444, 8=>50.53711507397311, 9=>40.0, 10=>47.16990566028302, 11=>57.0087712549569, 12=>15.811388300841896, 13=>25.495097567963924, 14=>41.23105625617661, 15=>29.154759474226502, 16=>45.0, 17=>50.99019513592785, 18=>40.311288741492746}, 
                5=>{0=>20.615528128088304, 1=>32.202484376209235, 2=>23.853720883753127, 3=>42.720018726587654, 4=>41.23105625617661, 5=>Infinity, 6=>10.0, 7=>20.615528128088304, 8=>13.92838827718412, 9=>50.0, 10=>33.54101966249684, 11=>35.35533905932738, 12=>35.35533905932738, 13=>15.811388300841896, 14=>20.0, 15=>29.154759474226502, 16=>11.180339887498949, 17=>10.0, 18=>11.180339887498949}, 
                6=>{0=>11.180339887498949, 1=>24.839484696748443, 2=>16.401219466856727, 3=>33.54101966249684, 4=>31.622776601683793, 5=>10.0, 6=>Infinity, 7=>20.615528128088304, 8=>19.849433241279208, 9=>42.42640687119285, 10=>30.4138126514911, 11=>35.35533905932738, 12=>25.495097567963924, 13=>7.0710678118654755, 14=>22.360679774997898, 15=>25.495097567963924, 16=>18.027756377319946, 17=>20.0, 18=>11.180339887498949}, 
                7=>{0=>21.213203435596427, 1=>21.02379604162864, 2=>36.24913792078372, 3=>35.35533905932738, 4=>46.09772228646444, 5=>20.615528128088304, 6=>20.615528128088304, 7=>Infinity, 8=>12.206555615733702, 9=>36.40054944640259, 10=>14.142135623730951, 11=>15.0, 12=>33.54101966249684, 13=>26.92582403567252, 14=>40.311288741492746, 15=>46.09772228646444, 16=>31.622776601683793, 17=>25.0, 18=>10.0}, 
                8=>{0=>26.248809496813376, 1=>31.575306807693888, 2=>36.069377593742864, 3=>45.044422518220834, 4=>50.53711507397311, 5=>13.92838827718412, 6=>19.849433241279208, 7=>12.206555615733702, 8=>Infinity, 9=>48.104053883222775, 10=>26.248809496813376, 11=>24.166091947189145, 12=>40.792156108742276, 13=>26.90724809414742, 14=>33.37663853655727, 15=>42.941821107167776, 16=>23.0, 17=>13.92838827718412, 18=>10.44030650891055}, 
                9=>{0=>32.01562118716424, 1=>17.804493814764857, 2=>47.4236228055175, 3=>15.0, 4=>40.0, 5=>50.0, 6=>42.42640687119285, 7=>36.40054944640259, 8=>48.104053883222775, 9=>Infinity, 10=>25.0, 11=>35.35533905932738, 12=>25.495097567963924, 13=>43.01162633521314, 14=>64.03124237432849, 15=>60.41522986797286, 16=>60.207972893961475, 17=>58.309518948453004, 18=>40.311288741492746}, 
                10=>{0=>25.495097567963924, 1=>15.556349186104045, 2=>43.289721643826724, 3=>29.154759474226502, 4=>47.16990566028302, 5=>33.54101966249684, 6=>30.4138126514911, 7=>14.142135623730951, 8=>26.248809496813376, 9=>25.0, 10=>Infinity, 11=>11.180339887498949, 12=>32.01562118716424, 13=>35.0, 14=>52.20153254455275, 15=>55.0, 16=>44.721359549995796, 17=>39.05124837953327, 18=>22.360679774997898}, 
                11=>{0=>33.54101966249684, 1=>26.40075756488817, 2=>50.28916384272063, 3=>40.311288741492746, 4=>57.0087712549569, 5=>35.35533905932738, 6=>35.35533905932738, 7=>15.0, 8=>24.166091947189145, 9=>35.35533905932738, 10=>11.180339887498949, 11=>Infinity, 12=>42.42640687119285, 13=>41.23105625617661, 14=>55.226805085936306, 15=>60.8276253029822, 16=>46.09772228646444, 17=>38.07886552931954, 18=>25.0}, 
                12=>{0=>15.0, 1=>16.64331697709324, 2=>23.430749027719962, 3=>11.180339887498949, 4=>15.811388300841896, 5=>35.35533905932738, 6=>25.495097567963924, 7=>33.54101966249684, 8=>40.792156108742276, 9=>25.495097567963924, 10=>32.01562118716424, 11=>42.42640687119285, 12=>Infinity, 13=>22.360679774997898, 14=>43.01162633521314, 15=>36.05551275463989, 16=>42.720018726587654, 17=>45.27692569068709, 18=>30.4138126514911}, 
                13=>{0=>11.180339887498949, 1=>26.40075756488817, 2=>9.433981132056603, 3=>32.01562118716424, 4=>25.495097567963924, 5=>15.811388300841896, 6=>7.0710678118654755, 7=>26.92582403567252, 8=>26.90724809414742, 9=>43.01162633521314, 10=>35.0, 11=>41.23105625617661, 12=>22.360679774997898, 13=>Infinity, 14=>21.213203435596427, 15=>20.0, 16=>20.615528128088304, 17=>25.495097567963924, 18=>18.027756377319946}, 
                14=>{0=>32.01562118716424, 1=>46.87216658103186, 2=>21.18962010041709, 3=>53.150729063673246, 4=>41.23105625617661, 5=>20.0, 6=>22.360679774997898, 7=>40.311288741492746, 8=>33.37663853655727, 9=>64.03124237432849, 10=>52.20153254455275, 11=>55.226805085936306, 12=>43.01162633521314, 13=>21.213203435596427, 14=>Infinity, 15=>15.811388300841896, 16=>11.180339887498949, 17=>22.360679774997898, 18=>30.4138126514911}, 
                15=>{0=>30.4138126514911, 1=>45.35416188179427, 2=>13.0, 3=>47.16990566028302, 4=>29.154759474226502, 5=>29.154759474226502, 6=>25.495097567963924, 7=>46.09772228646444, 8=>42.941821107167776, 9=>60.41522986797286, 10=>55.0, 11=>60.8276253029822, 12=>36.05551275463989, 13=>20.0, 14=>15.811388300841896, 15=>Infinity, 16=>25.0, 17=>35.35533905932738, 18=>36.40054944640259}, 
                16=>{0=>29.154759474226502, 1=>42.44997055358225, 2=>25.179356624028344, 3=>51.478150704935004, 4=>45.0, 5=>11.180339887498949, 6=>18.027756377319946, 7=>31.622776601683793, 8=>23.0, 9=>60.207972893961475, 10=>44.721359549995796, 11=>46.09772228646444, 12=>42.720018726587654, 13=>20.615528128088304, 14=>11.180339887498949, 15=>25.0, 16=>Infinity, 17=>11.180339887498949, 18=>22.360679774997898}, 
                17=>{0=>30.4138126514911, 1=>40.70626487409524, 2=>32.69556544854363, 3=>52.20153254455275, 4=>50.99019513592785, 5=>10.0, 6=>20.0, 7=>25.0, 8=>13.92838827718412, 9=>58.309518948453004, 10=>39.05124837953327, 11=>38.07886552931954, 12=>45.27692569068709, 13=>25.495097567963924, 14=>22.360679774997898, 15=>35.35533905932738, 16=>11.180339887498949, 17=>Infinity, 18=>18.027756377319946}, 
                18=>{0=>15.811388300841896, 1=>22.847319317591726, 2=>27.459060435491963, 3=>35.35533905932738, 4=>40.311288741492746, 5=>11.180339887498949, 6=>11.180339887498949, 7=>10.0, 8=>10.44030650891055, 9=>40.311288741492746, 10=>22.360679774997898, 11=>25.0, 12=>30.4138126514911, 13=>18.027756377319946, 14=>30.4138126514911, 15=>36.40054944640259, 16=>22.360679774997898, 17=>18.027756377319946, 18=>Infinity}}
brunch_cut = BrunchAndCut.new()
@solution = brunch_cut.find_solution(Distance_matrix)

@res = [@solution.first.first]
loop do
  @res << @solution[@res.last]
  if @res.last == @res.first 
    if @res.length == Size_start_matrix
      puts "Done! No cycles"
    else
      puts "Has cycles"
    end
    break
  end
end
